"use strict";function Controller(){var t=document.querySelector(".js--controller"),i=this;this.rAFId,this.joystick={enabled:!1,touchID:null,velocity:{x:0,y:0,acceleration:0},gutter:24,position:{x:function(){return i.joystick.outerCircle.radius+i.joystick.gutter},y:function(){return window.innerHeight-i.joystick.outerCircle.radius-i.joystick.gutter}},outerCircle:{radius:75,color:"#78879f",width:"10"},innerCircle:{radius:35,color:"#ffffff"}},this.burst={gutter:24,radius:75,position:{x:function(){return window.innerWidth-i.burst.radius-i.burst.gutter},y:function(){return window.innerHeight-i.burst.radius-i.burst.gutter}},color:"#fcb116",activeColor:"#78879f"},this.touches=[],this.canvas=createEle(!1,"canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.canvas.addEventListener("touchstart",function(t){i.touchHandler(t,i)},!1),this.canvas.addEventListener("touchmove",function(t){i.touchHandler(t,i)},!1),this.canvas.addEventListener("touchend",function(t){i.touchHandler(t,i),i.joystick.touchID==t.changedTouches[0].identifier&&(i.joystick.enabled=!1,i.joystick.touchID=null,i.joystick.velocity.x=0,i.joystick.velocity.y=0,i.joystick.velocity.acceleration=0)},!1)}Controller.prototype.touchHandler=function(t,i){t.clientX&&t.clientY?i.touches[0]=t:(i.touches=t.targetTouches,t.preventDefault())},Controller.prototype.getJoystickVelocity=function(){return this.joystick.velocity},Controller.prototype.loop=function(){var t=this;this.rAFId=window.requestAnimationFrame(t.loop.bind(this)),this.canvas.height!=window.innerHeight&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawButtons()},Controller.prototype.start=function(){var t=this;t.rAFId||t.loop()},Controller.prototype.stop=function(){var t=this;t.rAFId&&(window.cancelAnimationFrame(t.rAFId),t.rAFId=void 0)},Controller.prototype.drawButtons=function(){var t=this;this.context.strokeStyle=this.joystick.outerCircle.color,this.context.lineWidth=this.joystick.outerCircle.width,this.context.beginPath(),this.context.arc(t.joystick.position.x(),t.joystick.position.y(),t.joystick.outerCircle.radius,0,2*Math.PI,!0),this.context.stroke();var i={position:{x:t.joystick.position.x(),y:t.joystick.position.y()}},o={color:t.burst.color};eachNode(this.touches,function(e){var n={radius:Math.pow(t.joystick.outerCircle.radius,2),xSide:function(){return t.joystick.position.x()-e.clientX},ySide:function(){return t.joystick.position.y()-e.clientY},pythagorean:function(){return Math.pow(n.xSide(),2)+Math.pow(n.ySide(),2)}};if(n.pythagorean()<n.radius)t.joystick.enabled=!0,t.joystick.touchID=e.identifier,i.position.x=e.clientX,i.position.y=e.clientY,t.joystick.velocity.acceleration=100*n.pythagorean()/n.radius,t.postCoords();else if(t.joystick.touchID==e.identifier&&t.joystick.enabled){var r=t.joystick.outerCircle.radius/Math.sqrt(n.pythagorean());i.position.x=t.joystick.position.x()-n.xSide()*r,i.position.y=t.joystick.position.y()-n.ySide()*r,t.joystick.velocity.acceleration=100,t.postCoords()}var s={radius:Math.pow(t.burst.radius,2),xSide:function(){return t.burst.position.x()-e.clientX},ySide:function(){return t.burst.position.y()-e.clientY},pythagorean:function(){return Math.pow(s.xSide(),2)+Math.pow(s.ySide(),2)}};s.pythagorean()<s.radius&&(o.color=t.burst.activeColor),t.joystick.touchID==e.identifier&&t.joystick.enabled&&(t.joystick.position.x()>e.clientX?t.joystick.velocity.x=-1:t.joystick.position.x()<e.clientX&&(t.joystick.velocity.x=1),t.joystick.position.y()>e.clientY?t.joystick.velocity.y=-1:t.joystick.position.y()<e.clientY&&(t.joystick.velocity.y=1))}),this.context.fillStyle=this.joystick.innerCircle.color,this.context.beginPath(),this.context.arc(i.position.x,i.position.y,t.joystick.innerCircle.radius,0,2*Math.PI,!0),this.context.fill(),this.context.fillStyle=o.color,this.context.beginPath(),this.context.arc(t.burst.position.x(),t.burst.position.y(),t.burst.radius,0,2*Math.PI,!0),this.context.fill()},Controller.prototype.postCoords=function(){var t=this;socket.emit("userUpdateCoords",t.getJoystickVelocity())};var Controller=new Controller;