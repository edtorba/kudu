"use strict";function Controller(){var t=document.querySelector(".js--controller"),i=this;this.joystick={enabled:!1,touchID:null,velocity:{x:0,y:0,acceleration:0},gutter:24,position:{x:function(){return i.joystick.outerCircle.radius+i.joystick.gutter},y:function(){return window.innerHeight-i.joystick.outerCircle.radius-i.joystick.gutter}},outerCircle:{radius:75,color:"#78879f",width:"10"},innerCircle:{radius:35,color:"#ffffff"}},this.burst={enabled:!1,touchID:null,gutter:24,radius:75,position:{x:function(){return window.innerWidth-i.burst.radius-i.burst.gutter},y:function(){return window.innerHeight-i.burst.radius-i.burst.gutter}},color:"#fcb116"},this.touches=[],this.canvas=createEle(!1,"canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.canvas.addEventListener("touchstart",function(t){i.touchHandler(t,i)},!1),this.canvas.addEventListener("touchmove",function(t){i.touchHandler(t,i)},!1),this.canvas.addEventListener("touchend",function(t){i.touchHandler(t,i),i.joystick.touchID==t.changedTouches[0].identifier&&(i.joystick.enabled=!1,i.joystick.touchID=null,i.joystick.velocity.x=0,i.joystick.velocity.y=0,i.joystick.velocity.acceleration=0)},!1)}Controller.prototype.touchHandler=function(t,i){t.clientX&&t.clientY?i.touches[0]=t:(i.touches=t.targetTouches,t.preventDefault())},Controller.prototype.getJoystickVelocity=function(){return this.joystick.velocity},Controller.prototype.loop=function(){var t=this;this.canvas.height!=window.innerHeight&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.strokeStyle=this.joystick.outerCircle.color,this.context.lineWidth=this.joystick.outerCircle.width,this.context.beginPath(),this.context.arc(t.joystick.position.x(),t.joystick.position.y(),t.joystick.outerCircle.radius,0,2*Math.PI,!0),this.context.stroke();var i={position:{x:t.joystick.position.x(),y:t.joystick.position.y()}};eachNode(this.touches,function(o){var e={radius:Math.pow(t.joystick.outerCircle.radius,2),xSide:function(){return t.joystick.position.x()-o.clientX},ySide:function(){return t.joystick.position.y()-o.clientY},pythagorean:function(){return Math.pow(e.xSide(),2)+Math.pow(e.ySide(),2)}};if(e.pythagorean()<e.radius)t.joystick.enabled=!0,t.joystick.touchID=o.identifier,i.position.x=o.clientX,i.position.y=o.clientY,t.joystick.velocity.acceleration=100*e.pythagorean()/e.radius;else if(t.joystick.touchID==o.identifier&&t.joystick.enabled){var n=t.joystick.outerCircle.radius/Math.sqrt(e.pythagorean());i.position.x=t.joystick.position.x()-e.xSide()*n,i.position.y=t.joystick.position.y()-e.ySide()*n,t.joystick.velocity.acceleration=100}var c={radius:Math.pow(t.burst.radius,2),xSide:function(){return t.burst.position.x()-o.clientX},ySide:function(){return t.burst.position.y()-o.clientY},pythagorean:function(){return Math.pow(c.xSide(),2)+Math.pow(c.ySide(),2)}};c.pythagorean()<c.radius&&console.log("Shooting"),t.joystick.touchID==o.identifier&&t.joystick.enabled&&(t.joystick.position.x()>o.clientX?t.joystick.velocity.x=-1:t.joystick.position.x()<o.clientX&&(t.joystick.velocity.x=1),t.joystick.position.y()>o.clientY?t.joystick.velocity.y=1:t.joystick.position.y()<o.clientY&&(t.joystick.velocity.y=-1))}),this.context.fillStyle=this.joystick.innerCircle.color,this.context.beginPath(),this.context.arc(i.position.x,i.position.y,t.joystick.innerCircle.radius,0,2*Math.PI,!0),this.context.fill(),this.context.fillStyle=this.burst.color,this.context.beginPath(),this.context.arc(t.burst.position.x(),t.burst.position.y(),t.burst.radius,0,2*Math.PI,!0),this.context.fill()};var Controller=new Controller;!function t(){requestAnimFrame(t),Controller.loop()}();